<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ProjectFrontSQL">

	<select id="ProjectFrontSQL.countApplyList" resultType="int">

		/*
		SQL ID : ProjectFrontSQL.countApplyList
		project table 게시물 카운트
		*/
		SELECT COUNT(*)
		FROM
		tblproject
		WHERE
		project_title like CONCAT('%',#{project_title},'%')
		AND
		delete_flag = 'N'
		AND
		project_proc_status in('10','20','50')
		<if test="project_year != ''">
			AND
			project_year = ${project_year}::varchar
		</if>
		<if test="process_status != ''">
			AND
			project_proc_status = ${project_proc_status}::varchar
		</if>
	</select>

	<select id="ProjectFrontSQL.selectApplyList"
		resultType="dataMap">
		/*
		SQL ID : ProjectFrontSQL.selectApplyList
		사업공고 리스트
		*/
		<![CDATA[
		SELECT
		a.project_seqno,
		a.project_year,
		a.project_title,
		a.project_proc_status,
		TO_CHAR(a.project_apply_sdate,'YYYY-MM-DD') as project_apply_sdate,
		TO_CHAR(a.project_apply_edate,'YYYY-MM-DD') as project_apply_edate,
		a.insert_date,
		a.delete_flag,
		a.update_date,
		a.project_desc,
		a.fmst_seq,
		a.project_title,
		a.insert_user,
		a.update_user,
		a.project_req_match,
		a.project_proc_status,
		a.board_flag,
		a.insert_ip,
		a.update_ip,
		(select CASE WHEN b.project_apply_sdate > NOW()
		        	THEN 'Y' 
		        	ELSE 'N' 
	      	   		END
	      	  	FROM tblproject b
	      		WHERE a.project_seqno = b.project_seqno) as sdate_chk,
		(select CASE WHEN b.project_apply_edate < NOW()
		        	THEN 'Y' 
		        	ELSE 'N' 
	      	   		END
	      	  	FROM tblproject b
	      		WHERE a.project_seqno = b.project_seqno) as edate_chk
	     ]]>
		FROM
		tblproject a
		WHERE
		a.project_title like CONCAT('%',#{project_title},'%') 
		AND
		a.delete_flag = 'N'
		<if test="project_year != ''" >
		AND 
		a.project_year = ${project_year}::varchar
		</if>
		<if test="process_status != ''" >
		AND 
		a.project_proc_status = ${project_proc_status}::varchar
		</if>
		ORDER BY a.insert_date DESC
		limit ${rows}::INT offset (${page}::INT -1) * 10

	</select>
	<select id="ProjectFrontSQL.selectApplyDetail"
		resultType="dataMap">
		/*
		SQL ID : ProjectFrontSQL.selectApplyDetail
		사업공고 상세보기
		*/
		<![CDATA[
		SELECT
		a.project_seqno,
		a.project_title,
		a.project_apply_sdate,
		a.project_apply_edate,
		a.project_desc,
		a.project_proc_status,
		a.fmst_seq,
		(select CASE WHEN b.project_apply_sdate > NOW()
		        	THEN 'Y' 
		        	ELSE 'N' 
	      	   		END
	      	  	FROM tblproject b
	      		WHERE a.project_seqno = b.project_seqno) as sdate_chk,
		(select CASE WHEN b.project_apply_edate < NOW()
		        	THEN 'Y' 
		        	ELSE 'N' 
	      	   		END
	      	  	FROM tblproject b
	      		WHERE a.project_seqno = b.project_seqno) as edate_chk
	     ]]>
		FROM
		tblproject a
		WHERE
		project_seqno = #{project_seqno}::INT
	</select>
	
	<select id="ProjectFrontSQL.doFrontBusiness" resultType="dataMap">
		/*
			SQL ID : ProjectFrontSQL.doFrontBusiness
			사업자등록증 가져오기
		*/
		SELECT * 
		FROM voucher.tblmember t 
		inner join voucher.tblbusiness t2 on t.biz_seqno = t2.biz_seqno 
		where t.id = #{id}
	</select>
	
	<select id="ProjectFrontSQL.doFrontBusiness2" resultType="dataMap">
		/*
			SQL ID : ProjectFrontSQL.doFrontBusiness2
			사업자등록증 가져오기
		*/
		SELECT * 
		FROM voucher.tblmember t 
		inner join voucher.tblbusiness t2 on t.biz_seqno = t2.biz_seqno 
		where t.member_seqno = #{member_seqno}::INT
	</select>
</mapper>	