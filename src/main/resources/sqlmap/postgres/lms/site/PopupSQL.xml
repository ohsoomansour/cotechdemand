<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="PopupSQL">

	<sql id="search">
		<if test="popuptitle != ''">
			AND POPUP_TITLE LIKE '%' || #{popuptitle} || '%'
		</if>	
		<if test="useyn !=''">
			AND USEYN = #{useyn}
		</if>

	</sql>
	
	<select id="PopupSQL.doListPopup" resultType="dataMap">
		/*
			SQL ID : PopupSQL.doListPopup
			팝업 관리 리스트
		*/
		<![CDATA[
			SELECT
			*
			FROM
			(		
			SELECT 
				ROW_NUMBER() OVER(ORDER BY MODDTM DESC) RNUM,
				POPUP_SEQ,
				POPUP_TITLE,
				POPUP_SDAY,
				POPUP_EDAY,
				POPUP_IMG,
				POPUP_HEIGHT,
				POPUP_WIDTH,
				POPUP_LEFT,
				POPUP_TOP,
				(SELECT CDNM FROM TA_COMM_CODE WHERE COMMCD_GCD = 'POPUP_PCD' AND POPUP_PCD = COMMCD) AS POPUP_PCD,
				REGUID,
				MODUID,
			    TO_CHAR(TO_DATE(REGDTM, 'yyyymmddHH24MISS'),'YYYY/MM/DD HH24:MI') AS REGDTM,
				TO_CHAR(TO_DATE(MODDTM, 'yyyymmddHH24MISS'),'YYYY/MM/DD HH24:MI') AS MODDTM,
				USEYN
			FROM
				TA_POPUP
			WHERE 
				SITEID = #{siteid}						
		]]>
		<include refid="search"/>
	<![CDATA[		
			) AS POPUPLIST
			WHERE RNUM BETWEEN (#{page}::INT -1) * (#{rows}::INT) + 1 AND #{page}::INT * #{rows}::INT  					
		]]>	
	</select>
	
	<select id="PopupSQL.doCountPopup" resultType="int">
		/*
			SQL ID : PopupSQL.doCountPopup
			팝업 관리 카운트
		*/
		<![CDATA[
			SELECT
			COUNT(*)
			FROM
				TA_POPUP	
			WHERE 
				SITEID = #{siteid}					
		]]>
		<include refid="search"/>
	</select>	

	<insert id="PopupSQL.doInsertPopup" parameterType="dataMap">
		/* 
			2020.04.29 박인정
			SQL ID : PopupSQL.doInsertPopup
			팝업 등록
		*/
		 	INSERT INTO TA_POPUP	
				(
					POPUP_SEQ,
					POPUP_TITLE,
					POPUP_IMG,
					POPUP_SDAY,
					POPUP_EDAY,
					POPUP_PCD,
					POPUP_HEIGHT,
					POPUP_WIDTH,
					POPUP_LEFT,
					POPUP_TOP,
					REGUID,
					MODUID,
					REGDTM,
					MODDTM,
					USEYN,
					SITEID
				)
			VALUES
				(
					#{popup_seq},
					#{popup_title},
					#{popup_img},
					#{popup_sday},
					#{popup_eday},
					#{popup_pcd},
					#{popup_height}::INT,
					#{popup_width}::INT,
					#{popup_left}::INT,
					#{popup_top}::INT,
					#{userid},
					#{userid},
					TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'),
					TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'),
					#{useyn},
					#{siteid}
				)	
	</insert>
	
	<select id="PopupSQL.doGetPopup" resultType="dataMap">
		/*
			SQL ID : PopupSQL.doGetPopup
			팝업 정보 가져오기
		*/
			<![CDATA[
				SELECT 
					POPUP_SEQ,
					POPUP_TITLE,
					POPUP_IMG,
					POPUP_SDAY,
					POPUP_EDAY,
					POPUP_PCD,
					POPUP_HEIGHT,
					POPUP_WIDTH,
					POPUP_LEFT,
					POPUP_TOP,
					MODUID,
					MODDTM,
					USEYN
				FROM
					TA_POPUP	
				WHERE 
					POPUP_SEQ = #{popup_seq}::INT
				]]>		
	</select>	
	
	<update id="PopupSQL.doUpdatePopup" parameterType="dataMap">
		/*
			SQL ID : PopupSQL.doUpdatePopup
			팝업 수정
		*/
		UPDATE TA_POPUP
		SET 
			POPUP_TITLE = #{popup_title},				
			POPUP_SDAY = #{popup_sday}, 
			POPUP_EDAY = #{popup_eday},
			POPUP_PCD = #{popup_pcd},
			POPUP_HEIGHT = #{height}::INT,
			POPUP_WIDTH = #{width}::INT,
			POPUP_LEFT = #{left}::INT,
			POPUP_TOP = #{top}::INT,				
			MODUID = #{userid},
			USEYN = #{useyn},
			MODDTM = TO_CHAR(NOW(), 'YYYYMMDDHH24MISS')	
		<if test="popup_img != ''" >
		   ,POPUP_IMG = #{popup_img}
		</if>
		WHERE
			POPUP_SEQ = #{popup_seq}::INT		
	</update>
	
	<delete id="PopupSQL.doDeletePopup" parameterType="dataMap">
		/*
			SQL ID : PopupSQL.doDeletePopup
			팝업 삭제
		*/
		<![CDATA[
			DELETE
			FROM
				TA_POPUP
			WHERE
				POPUP_SEQ = #{popup_seq}::INT
		]]>
	</delete>
	
	<update id="PopupSQL.doDeletePopupView" parameterType="dataMap">
		/*
			SQL ID: PopupSQL.doDeletePopupView
					팝업 이미지 삭제
		*/
		UPDATE TA_POPUP
		SET 
			POPUP_IMG = NULL
		WHERE 
			POPUP_SEQ = #{popup_seq}::INT
	</update>
	
	<select id="PopupSQL.doListMainPopup" resultType="dataMap">
		/*
			SQL ID : PopupSQL.doListMainPopup
			메인 팝업 리스트
		*/
		<![CDATA[
		SELECT
			POPUP_SEQ,
			POPUP_TITLE,
			POPUP_IMG,
			POPUP_HEIGHT,
			POPUP_WIDTH,
			POPUP_LEFT,
			POPUP_TOP
		FROM 
			TA_POPUP	
		WHERE 
			USEYN = 'Y'
		AND TO_CHAR(NOW(),'YYYY-MM-DD') BETWEEN POPUP_SDAY AND POPUP_EDAY
		ORDER BY POPUP_SEQ
		]]>
	</select>	
	
		<select id="PopupSQL.doListPopupCode" resultType="dataMap">
		/* 
			2020.06.17 박인정
			SQL ID : PopupSQL.doListPopupCode
			팝업 코드 정보 가져오기 
		*/
		<![CDATA[
 			SELECT	
				CDNM,
				COMMCD,
				COMMCD_CMMT,
				COMMCD_VAL1,
				COMMCD_VAL2							
		    FROM   
		        TA_COMM_CODE 
		    WHERE 
		    	COMMCD_GCD = #{commcd_gcd}
		    AND COMMCD_LVL = 2
           
		]]>		  
	</select>
</mapper>	