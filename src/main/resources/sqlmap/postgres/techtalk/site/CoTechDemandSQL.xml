<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="CoTechDemandSQL">
		<select id="CoTechDemandSQL.doGetCodeListInfo" parameterType="dataMap" resultType="dataMap">
		/*
			2023.09.18 
			SQL ID: TLOPageSQL.doGetCodeListInfo
			 기술분류 목록: depth에 따라 코드를 불러오고
		*/
		<![CDATA[
			SELECT
				*
			FROM
				TBTECH_CODE
			WHERE CODE_DEPTH = #{depth}::INT
			
		]]>
			<if test="parent_code_key != ''">
			AND PARENT_CODE_KEY = #{parent_code_key}
			</if>
			ORDER BY CODE_KEY ASC
		</select>	
		<select id="CoTechDemandSQL.doGetCoTechDemandInfo" parameterType="dataMap" resultType="dataMap" >
			/*
				SQL ID: TLOPageSQL.doGetCoTechDemandInfo
				기업 목록 조회  >> 변경중..
				code_key를 tbtec_code테이블에서 가져옴 
				(SELECT CODE_KEY FROM TBTEC_CODE TC WHERE TC.CODE_NAME = A.MID_SMALLCATEGORY) AS CODE_KEY  
			*/
			<![CDATA[
				SELECT 
					A.COMPA_NAME
					, CO_TD_NO
					, KEYWORD
					, SPLIT_PART(KEYWORD::VARCHAR, ',', 1) AS KEYWORD1
					, SPLIT_PART(KEYWORD::VARCHAR, ',', 2) AS KEYWORD2
					, SPLIT_PART(KEYWORD::VARCHAR, ',', 3) AS KEYWORD3
					, SPLIT_PART(KEYWORD::VARCHAR, ',', 4) AS KEYWORD4
					, SPLIT_PART(KEYWORD::VARCHAR, ',', 5) AS KEYWORD5
					, MID_CATEGORY
					, SMALL_CATEGORY
					, (SELECT CODE_NAME FROM tbtech_code AA WHERE AA.CODE_KEY = A.MID_CATEGORY) AS CODE_NAME2
					, (SELECT CODE_NAME FROM tbtech_code AA WHERE AA.CODE_KEY = A.SMALL_CATEGORY) AS CODE_NAME3
					, CORPORATE_PROBLEM
					, HOLD_RND_INFRA
					, WILLINGNESS_TO_INVEST
					, DEPT
					, MANAGER_POSITION
					, MANAGER_NAME
					, MOBILEPHONE_NUM
					, A.biz_email
					, MEMBER_SEQNO
					, TECH_NEEDS
				FROM TECHDEMAND_CORPORATE AS A
				INNER JOIN (SELECT * FROM TBLMEMBER WHERE id = '${id}') AS B
				ON A.MEMBER_SEQNO::INT = B.MEMBER_SEQNO
			]]>
	</select>

	<select id="CoTechDemandSQL.doAutoSearchKeyword" resultType="dataMap" parameterType="dataMap">
		/*
			키워드 검색
			2023.09.15
			SQL ID : CoTechDemandSQL.doAutoSearchKeyword
		*/
		<![CDATA[
			select tc.code_name 
			from tbtech_code tc 
			where tc.code_name like '%${code_name}%'
			group by tc.code_key;
		]]>
	</select>

	<select id="CoTechDemandSQL.getTLOSeqNo" resultType="dataMap" parameterType="dataMap">
		/*
		    지금 로그인한 기업 멤버아이디의 session 중 biz_name과 같은 tblmember.biz_name과 같은 tblmember.member_seqno를 찾아와야된다.
			CoTechDemandSQL.getTLOSeq_no
			2023.09.23
			SQL ID : CoTechDemandSQL.getTLOSeqNo
		*/
		<![CDATA[
			SELECT 
				MEMBER_SEQNO
			FROM TBLMEMBER 
			WHERE TBLMEMBER.BIZNAME = #{biz_name}
		]]>
	</select>
	<insert id="CoTechDemandSQL.registTechDemandCo" parameterType="dataMap" >
		/*
		2023.09.15
		SQL ID : CoTechDemandSQL.registTechDemandCo
		기술수요 등록 
		*/
		  
		<![CDATA[
			INSERT INTO 
				techdemand_corporate(
				co_td_no,
				mid_category,
				small_category,
				keyword,
				corporate_problem,
				hold_rnd_infra,	
				willingness_to_invest,	
				compa_name,	
				dept,	
				manager_position,	
				manager_name,	
				mobilephone_num,	
				biz_email,
				member_seqno,
				tech_needs,
				tlo_seqno		
			) 
			VALUES(
				nextval('co_techdemand__increment_seq'),
				#{medi_category},
				#{small_category},
				#{keyword_record},
				#{erro},
				#{rndInfra},
				#{investWilling},
				#{bizName},
				#{dept},
				#{managerPosition},
				#{managerName},
				#{userMobileNo},
				#{biz_email},
				#{member_seqno},
				#{tech_needs},
				#{tlo_seqno}		
			)
		]]>
		
		
	</insert>
	
</mapper>	