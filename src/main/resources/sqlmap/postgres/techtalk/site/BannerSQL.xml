<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BannerSQL">

	<sql id="search">
		<if test="bannertitle != ''">
			AND BANNER_TITLE LIKE '%' || #{bannertitle} || '%'
		</if>
		<if test="useyn !=''">
			AND USEYN = #{useyn}
		</if>
	</sql>
	
	<select id="BannerSQL.doListBanner" resultType="dataMap">
		/*
			SQL ID : BannerSQL.doListBanner
			배너 관리 리스트
		*/
		<![CDATA[
			SELECT
			*
			FROM
			(		
			SELECT 
				ROW_NUMBER() OVER(ORDER BY BANNER_IDX ASC, USEYN DESC) RNUM,
				BANNER_SEQ,
				BANNER_IDX,
				BANNER_TITLE,
				BANNER_IMG,
				BANNER_SDAY,
				BANNER_EDAY,
				REGUID,
				MODUID,
			    TO_CHAR(TO_DATE(REGDTM, 'yyyymmddHH24MISS'),'YYYY/MM/DD HH24:MI') AS REGDTM,
				TO_CHAR(TO_DATE(MODDTM, 'yyyymmddHH24MISS'),'YYYY/MM/DD HH24:MI') AS MODDTM,
				USEYN
			FROM
				TA_BANNER	
			WHERE 
				SITEID = #{siteid}	
		]]>
		<include refid="search"/>
	<![CDATA[	
			)
			AS BANNERLIST
			WHERE RNUM BETWEEN (#{page}::INT -1) * (#{rows}::INT) + 1 AND #{page}::INT * #{rows}::INT   					
		]]>	
	</select>
	
	<select id="BannerSQL.doCountBanner" resultType="int">
		/*
			SQL ID : BannerSQL.doCountBanner
			배너 관리 리스트
		*/
		<![CDATA[
			SELECT
			COUNT(*)
			FROM
				TA_BANNER	
			WHERE 
				SITEID = #{siteid}					
		]]>
		<include refid="search"/>
	</select>	
	
		
	<select id="BannerSQL.doCheckBanner" resultType="int" parameterType="dataMap">
		/*
			SQL ID : BannerSQL.doCheckBanner
			배너 순번 체크
		*/
		<![CDATA[
			SELECT
				COUNT(*) 			
			FROM
				TA_BANNER	
			WHERE
		]]>
		<choose>
			<when test="banner_idx == ''">
				BANNER_IDX = NULL
			</when>
			<otherwise>
				BANNER_IDX = #{banner_idx}::INT
			</otherwise>
		</choose>
	</select>
	
	<update id="BannerSQL.doUpdateBannerIdx" parameterType="dataMap">
		/*
			SQL ID : BannerSQL.doUpdateBannerIdx
			배너 순번 수정
		*/
			<![CDATA[
				UPDATE TA_BANNER
				SET
			]]>
			<choose>
				<when test="banner_idx == ''">
					BANNER_IDX = NULL
				</when>
				<otherwise>
					BANNER_IDX = #{banner_idx}::INT
				</otherwise>
			</choose>
			<![CDATA[
				WHERE 
					BANNER_SEQ = #{banner_seq}::INT
			]]>		
	</update>

	<select id="BannerSQL.doGetBanner" resultType="dataMap">
		/*
			SQL ID : BannerSQL.doGetBanner
			배너 수정 팝업
		*/
			<![CDATA[
				SELECT 
					BANNER_SEQ,
					BANNER_TITLE,
					BANNER_IDX,
					BANNER_IMG,
					BGCOLOR,
					BANNER_URL,
					BANNER_SDAY,
					BANNER_EDAY,
					BANNER_PCD,
					BANNER_TCD,
					USEYN
				FROM
					TA_BANNER	
				WHERE 
					BANNER_SEQ = #{banner_seq}::INT
				]]>		
	</select>
	

	<update id="BannerSQL.doUpdateBanner" parameterType="dataMap">
		/*
			SQL ID : BannerSQL.doUpdateBanner
			배너 수정~
		*/
			<![CDATA[
				UPDATE TA_BANNER
				SET 
					BANNER_TITLE = #{banner_title},
					BANNER_URL = #{banner_url},
					BANNER_SDAY = #{banner_sday}, 
					BANNER_EDAY = #{banner_eday},
					BANNER_PCD = #{banner_pcd},
					BANNER_TCD = #{banner_tcd},
					BGCOLOR = #{bgcolor},
					MODUID = #{userid},
					USEYN = #{useyn},	
					MODDTM = TO_CHAR(NOW(), 'YYYYMMDDHH24MISS')
			]]>
			<if test="banner_idx != ''">
					,BANNER_IDX = #{banner_idx}::INT
			</if>
			<if test="banner_img != ''" >
				   ,BANNER_IMG = #{banner_img}
			</if>
			<![CDATA[			
				WHERE 
					BANNER_SEQ = #{banner_seq}::INT
			]]>		
	</update>

	<insert id="BannerSQL.doInsertBanner" parameterType="dataMap">
		/* 
			2020.04.29 박인정
			SQL ID : BannerSQL.doInsertBanner
			배너 등록
		*/
		 	INSERT INTO TA_BANNER	
				(
					BANNER_SEQ,
					BANNER_TITLE,
					BANNER_IMG,
					BANNER_URL,
					BANNER_SDAY,
					BANNER_EDAY,
					BANNER_PCD,
					BANNER_TCD,
					BGCOLOR,
					REGUID,
					MODUID,
					REGDTM,
					MODDTM,
					USEYN,
					SITEID
				)
			VALUES
				(
					#{banner_seq},
					#{banner_title},
					#{banner_img},
					#{banner_url},
					#{banner_sday},
					#{banner_eday},
					#{banner_pcd},
					#{banner_tcd},
					#{bgcolor},
					#{userid},
					#{userid},
					TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'),
					TO_CHAR(NOW(), 'YYYYMMDDHH24MISS'),
					#{useyn},
					#{siteid}
				)							
	</insert> 	

	<delete id="BannerSQL.doDeleteBanner" parameterType="dataMap">
		/*
			SQL ID : BannerSQL.doDeleteBanner
			배너 삭제
		*/
		<![CDATA[
			DELETE
			FROM
				TA_BANNER
			WHERE
				BANNER_SEQ = #{banner_seq}::INT
		]]>
	</delete>	
	
	<select id="BannerSQL.doListBannerPcd" resultType="dataMap">
		/*
			SQL ID : BannerSQL.doListBannerPcd
			배너 관리 코드 Pcd
		*/
		<![CDATA[
			SELECT
				CDNM,
				COMMCD
			FROM
				TA_COMM_CODE
			WHERE
			    COMMCD_GCD = 'BANNER_PCD'  
			AND COMMCD_LVL = 2
		]]>
	</select>
	
	<select id="BannerSQL.doListBannerTcd" resultType="dataMap">
		/*
			SQL ID : BannerSQL.doListBannerTcd
			배너 관리 코드 Tcd
		*/
		<![CDATA[
			SELECT
				CDNM,
				COMMCD
			FROM
				TA_COMM_CODE
			WHERE
			    COMMCD_GCD = 'BANNER_TCD' 
			AND COMMCD_LVL = 2
		]]>
	</select>	
	
	<update id="BannerSQL.doDeleteBannerView" parameterType="dataMap">
		/*
			SQL ID: BannerSQL.doDeleteBannerView
					배너 이미지 삭제
		*/
		UPDATE TA_BANNER
		SET 
			BANNER_IMG = NULL
		WHERE 
			BANNER_SEQ = #{banner_seq}::INT
	</update>
	
	<select id="BannerSQL.doListMainBanner" resultType="dataMap">
		/*
			SQL ID: BannerSQL.doListMainBanner
					메인 배너 리스트
		*/	
		<![CDATA[
		SELECT
			BANNER_SEQ,
			BANNER_IMG,
			BANNER_URL,
			BANNER_IDX,
			BANNER_PCD,
			BGCOLOR
		FROM 
			TA_BANNER	
		WHERE 
			USEYN = 'Y'
		AND BANNER_IDX is not NULL
		AND TO_CHAR(NOW(),'YYYY-MM-DD') BETWEEN BANNER_SDAY AND BANNER_EDAY
		ORDER BY BANNER_IDX	
		]]>
	</select>
</mapper>