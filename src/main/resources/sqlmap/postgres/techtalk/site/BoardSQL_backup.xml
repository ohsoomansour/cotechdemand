<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="BoardSQL">

	<sql id="where_mng">
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			<if test="sc_boardmng_pcd != null and sc_boardmng_pcd != ''">
				AND BOARDMNG_PCD = #{sc_boardmng_pcd}
			</if>
			<if test="sc_useyn != null and sc_useyn != ''">
				AND USEYN = #{sc_useyn}
			</if>
			<if test="sc_boardnm != null and sc_boardnm != ''">
				AND BOARDNM = LIKE '%' || #{sc_boardnm} || '%'
			</if>
		</trim>
	</sql>

	<sql id="where_item">
		<trim prefix="WHERE" prefixOverrides="AND | OR">
			<if test="siteid != null and siteid != ''">
				AND A.SITEID = #{siteid}
			</if>
			<if test="useyn != null and useyn != ''">
				AND A.USEYN = #{useyn}
			</if>
			<if test="board_seq != null and board_seq != ''">
				AND A.BOARD_SEQ = #{board_seq}
			</if>
			<if test="edtuid != null and edtuid != ''">
				AND A.REGUID = #{edtuid}
			</if>
			<if test="ctgr_seq != null and ctgr_seq != ''">
				AND A.CTGR_SEQ = #{ctgr_seq}
			</if>
			<if test="sc_keywd != null and sc_keywd != ''">
				<if test="sc_where == 'TITLE'">
					AND A.BITEM_TITLE LIKE '%${sc_keywd}%'
				</if>
				<if test="sc_where == 'CONTENT'">
					AND A.BITEM_CONT LIKE '%${sc_keywd}%'
				</if>
				<if test="sc_where == 'TITLE_CONTENT'">
					AND (A.BITEM_TITLE LIKE '%${sc_keywd}%' OR A.BITEM_CONT LIKE '%${sc_keywd}%')
				</if>
				<if test="sc_where == 'WRITER'">
					AND A.REGUID IN (SELECT USERID FROM TW_ACTOR WHERE USERNM LIKE '%${sc_keywd}%')
				</if>
			</if>
		</trim>
	</sql>


<!-- ====================================================================================== -->
<!--						게시판관리 (TB_BOARD_MNG)											-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.countBoardMng" resultType="int">
		/*
			SQL ID : BoardSQL.countBoardMng
			게시판 카운트
		*/
		SELECT COUNT(*) FROM TB_BOARD_MNG
		<include refid="where_mng"/>
	</select>

	<select id="BoardSQL.dolistBoardMng" resultType="dataMap">
		/*
			SQL ID : BoardSQL.dolistBoardMng
			게시판 리스트
		*/
		<![CDATA[
		SELECT AA.RSEQ
			, AA.BOARD_SEQ, AA.BOARDNM, AA.USEYN, AA.ASPSID
			, (SELECT USERNM FROM TW_ACTOR WHERE USERID = AA.REGUID) REGUNM
			, (SELECT USERNM FROM TW_ACTOR WHERE USERID = AA.MODUID) MODUNM
			, TO_CHAR(MODDTM, 'YYYY.MM.DD') MODDTM
			, TO_CHAR(REGDTM, 'YYYY.MM.DD') REGDTM
			, (SELECT COUNT(1) FROM TB_BOARD_ITEM WHERE BOARD_SEQ = AA.BOARD_SEQ) AS ITEM_CNT
		]]>
		FROM (
			SELECT ROW_NUMBER() OVER (ORDER BY ${sidx} ${sord}) AS RSEQ, A.*
			FROM TB_BOARD_MNG A
			<include refid="where_mng"/>
		) AA
		WHERE AA.RSEQ BETWEEN (${page}-1) * ${rows} + 1 AND ${page} * ${rows}
	</select>

	<select id="BoardSQL.getoneBoardSeq" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : BoardSQL.getoneBoardSeq
			게시판코드 가져오기
		*/
		SELECT NVL(MAX(BOARD_SEQ),0) + 1 AS BOARD_SEQ FROM TB_BOARD_MNG
	</select>

	<select id="BoardSQL.getoneBoardMng" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.getoneBoardMng
			게시판 싱글데이터 조회
		*/
		SELECT *
		FROM TB_BOARD_MNG
		WHERE BOARD_SEQ = #{board_seq}
	</select>

	<select id="BoardSQL.comboxBoardMng" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.comboxBoardMng
			게시판 선택(selectbox)
		*/
		SELECT A.BOARDNM AS TITLE, A.BOARD_SEQ AS VALUE
		FROM TB_BOARD_MNG A
		WHERE 1 = 1
			AND A.BOARD_PCD = #{q_board_pcd}
			AND A.USEYN = 'Y'
	</select>


	<insert id="BoardSQL.appendBoardMng" parameterType="dataMap" useGeneratedKeys="false">
		/*
			SQL ID : BoardSQL.appendBoardMng
			게시판 등록
		*/
		INSERT INTO TB_BOARD_MNG
			( BOARD_SEQ
			, BOARDNM
			, BOARD_PCD
			, BOARD_TCD
			, BOARD_OPT
			, NEWD_STDT
			, ATTF_MAXCNT
			, ATTF_MAXSIZE
			, ATTF_AVAILEXT
			, BOARD_DESC
			, REGUID
			, MODUID
			, REGDTM
			, MODDTM
			, USEYN
			, SITEID
			)
		VALUES
			( #{board_seq}
			, #{boardnm}
			, NVL(#{board_pcd}		, '')
			, NVL(#{board_tcd}		, '')
			, NVL(#{board_opt}		, 0)
			, NVL(#{newd_stdt}		, 0)
			, NVL(#{attf_maxcnt}	, 0)
			, NVL(#{attf_maxsize}	, 0)
			, NVL(#{attf_availext}	, '')
			, #{board_desc}
			, #{userid}
			, #{userid}
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, NVL(#{useyn}			, 'N')
			, #{siteid}
			)
	</insert>

	<update id="BoardSQL.modifyBoardMng" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.modifyBoardMng
			게시판 수정
		*/
		UPDATE TB_BOARD_MNG
		SET BOARDNM				= #{boardnm}
			, BOARD_PCD			= #{board_pcd}
			, BOARD_TCD			= #{board_tcd}
			, BOARD_OPT			= #{board_opt}
			, NEWD_STDT			= #{newd_stdt}
			, ATTF_MAXCNT		= #{attf_maxcnt}
			, ATTF_MAXSIZE		= #{attf_maxsize}
			, ATTF_AVAILEXT		= #{attf_availext}
			, BOARD_DESC		= #{board_desc}
			, MODUID			= #{userid}
			, MODDTM			= TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, USEYN				= NVL(#{useyn},'N')
		WHERE BOARD_SEQ = #{board_seq}
		AND SITEID = #{siteid}
	</update>

	<delete id="BoardSQL.removeBoardMng" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardMng
			게시판 삭제
		*/
		DELETE FROM TB_BOARD_MNG
		WHERE BOARD_SEQ = #{board_seq}
		AND SITEID = #{siteid}
	</delete>



<!-- ====================================================================================== -->
<!--						게시물 (TB_BOARD_ITEM)											-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.countBoardItem" resultType="int">
		/*
			SQL ID : BoardSQL.countBoardItem
			게시물 카운트
		*/
		SELECT COUNT(*) FROM TB_BOARD_ITEM A
		<include refid="where_item"/>
	</select>

	<select id="BoardSQL.dolistBoardItem" resultType="DataMap">
		/*
			SQL ID : BoardSQL.dolistBoardItem
			게시물 목록 조회
		*/
		<![CDATA[
		SELECT AA.RSEQ
			, AA.BOARD_SEQ
			, AA.CTGR_SEQ
			, AA.BITEM_SEQ
			, AA.BITEM_TITLE
			, AA.BITEM_IDX
			, AA.BITEM_SEECNT
			, AA.BITEM_RFK
			, AA.BITEM_LVL
			, AA.REGUID
			, (SELECT CDNM FROM TC_COMM_CODE WHERE COMMCD =
				(SELECT BOARD_PCD FROM TB_BOARD_MNG WHERE BOARD_SEQ = AA.BOARD_SEQ))	AS BOARD_PNM
			, (SELECT BOARDNM FROM TB_BOARD_MNG WHERE BOARD_SEQ = AA.BOARD_SEQ)			AS BOARDNM
			, TO_CHAR(AA.REGDTM,'YYYY.MM.DD')	AS REGDTM
			, (SELECT USERNM FROM TW_ACTOR WHERE USERID = AA.REGUID)					AS REGUNM
			, (SELECT CTGRNM FROM TB_BOARD_CTGR
				WHERE AA.CTGR_SEQ = CTGR_SEQ AND AA.BOARD_SEQ = BOARD_SEQ)				AS CTGRNM
			, (SELECT COUNT(1) FROM TB_BOARD_RECOM WHERE AA.BITEM_SEQ = BITEM_SEQ)		AS RECOM_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_CMMT WHERE AA.BITEM_SEQ = BITEM_SEQ)		AS CMMT_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_ITEM WHERE AA.BITEM_SEQ = BITEM_SEQ AND BITEM_LVL > 1) AS A_CNT
			, (SELECT CASE WHEN AA.REGDTM + NVL(NEWD_STDT,0) > TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') THEN 'Y' ELSE 'N' END
				FROM TB_BOARD_MNG WHERE AA.BOARD_SEQ = BOARD_SEQ )						AS NEW_YN
		]]>
		FROM (
			SELECT ROW_NUMBER() OVER (ORDER BY BITEM_RFK DESC, BITEM_IDX, BITEM_LVL) AS RSEQ, A.*
			FROM (
				SELECT * FROM TB_BOARD_ITEM A
				<include refid="where_item"/>
			) A
		) AA
		WHERE AA.RSEQ BETWEEN (${page}-1) * ${rows} + 1 AND ${page} * ${rows}
	</select>

	<select id="BoardSQL.getoneBoardItem" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.getoneBoardItem
			게시물 싱글데이터 조회
		*/
		<![CDATA[
		SELECT A.*
			, B.USERNM
			, B.USERID
			, B.EMAIL
			, (SELECT CTGRNM FROM TB_BOARD_CTGR WHERE A.CTGR_SEQ = CTGR_SEQ)		AS CTGRNM
			, (SELECT COUNT(1) FROM TB_BOARD_RECOM WHERE A.BITEM_SEQ = BITEM_SEQ)	AS RECOM_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_CMMT WHERE A.BITEM_SEQ = BITEM_SEQ)	AS CMMT_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_ITEM WHERE A.BITEM_SEQ = BITEM_SEQ AND BITEM_LVL > 1) AS A_CNT
			, TO_CHAR(A.REGDTM,'YYYY-MM-DD HH24:MI') AS F_REGDTM
			, TO_CHAR(A.MODDTM,'YYYY-MM-DD HH24:MI') AS F_MODDTM
		]]>
		FROM TB_BOARD_ITEM A, TW_ACTOR B
		WHERE B.USERID = A.REGUID
			AND A.BITEM_SEQ = #{bitem_seq}
			AND SITEID = #{siteid}
	</select>

	<select id="BoardSQL.getoneOrders" resultType="int">
		/*
			SQL ID : BoardSQL.getoneOrders
			순번가져오기
		*/
		SELECT NVL(OD,(SELECT NVL(BITEM_IDX+1,1) FROM TB_BOARD_ITEM WHERE BITEM_SEQ = #{up_seq}))
		FROM (SELECT MAX(BITEM_IDX) + 1 AS OD FROM TB_BOARD_ITEM A WHERE UP_SEQ = #{up_seq})
	</select>

	<select id="BoardSQL.getoneOrdersTwo" resultType="int">
		/*
			SQL ID : BoardSQL.getoneOrdersTwo
			2뎁스 순번가져오기
		*/
		SELECT MAX(BITEM_IDX) + 1 FROM TB_BOARD_ITEM A
		WHERE A.BITEM_RFK = #{up_seq}
	</select>

	<select id="BoardSQL.getoneBoardItemPrev" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : BoardSQL.getoneBoardItemPrev
			이전글 가져오기
		*/
		SELECT A.BITEM_SEQ, A.BITEM_TITLE
		FROM TB_BOARD_ITEM A,
		(
			SELECT MAX(BITEM_SEQ) AS BITEM_SEQ FROM TB_BOARD_ITEM A
			WHERE BITEM_RFK <![CDATA[ > ]]> (SELECT BITEM_RFK FROM TB_BOARD_ITEM WHERE BITEM_SEQ = #{bitem_seq})
				AND BITEM_LVL = 1
			<if test="board_seq != null and board_seq != ''">
				AND A.BOARD_SEQ = #{board_seq}
			</if>
		) B
		WHERE A.BITEM_SEQ = B.BITEM_SEQ
	</select>

	<select id="BoardSQL.getoneBoardItemNext" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : BoardSQL.getoneBoardItemNext
			다음글 가져오기
		*/
		SELECT A.BITEM_SEQ, A.BITEM_TITLE
		FROM TB_BOARD_ITEM A,
		(
			SELECT MAX(BITEM_SEQ) AS BITEM_SEQ FROM TB_BOARD_ITEM A
			WHERE BITEM_RFK <![CDATA[ < ]]> (SELECT BITEM_RFK FROM TB_BOARD_ITEM WHERE BITEM_SEQ = #{bitem_seq})
				AND BITEM_LVL = 1
			<if test="board_seq != null and board_seq != ''">
				AND A.BOARD_SEQ = #{board_seq}
			</if>
		) B
		WHERE A.BITEM_SEQ = B.BITEM_SEQ
	</select>

	<select id="BoardSQL.dolistRefBoardItem" resultType="DataMap">
		/*
			SQL ID : BoardSQL.dolistRefBoardItem
			관련 게시물 목록 조회
		*/
		<![CDATA[
		SELECT AA.RSEQ
			, AA.BOARD_SEQ
			, AA.CTGR_SEQ
			, AA.BITEM_SEQ
			, AA.BITEM_TITLE
			, AA.BITEM_IDX
			, AA.BITEM_SEECNT
			, AA.BITEM_RFK
			, AA.BITEM_LVL
			, AA.REGUID
			, (SELECT CDNM FROM TC_COMM_CODE WHERE COMMCD =
				(SELECT BOARD_PCD FROM TB_BOARD_MNG WHERE BOARD_SEQ = AA.BOARD_SEQ))	AS BOARD_PNM
			, (SELECT BOARDNM FROM TB_BOARD_MNG WHERE BOARD_SEQ = AA.BOARD_SEQ)			AS BOARDNM
			, TO_CHAR(AA.REGDTM, 'YYYY.MM.DD')	AS REGDTM
			, (SELECT USERNM FROM TW_ACTOR WHERE USERID = AA.REGUID)					AS REGUNM
			, (SELECT CTGRNM FROM TB_BOARD_CTGR
				WHERE AA.CTGR_SEQ = CTGR_SEQ AND AA.BOARD_SEQ = BOARD_SEQ)				AS CTGRNM
			, (SELECT COUNT(1) FROM TB_BOARD_RECOM WHERE AA.BITEM_SEQ = BITEM_SEQ)		AS RECOM_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_CMMT WHERE AA.BITEM_SEQ = BITEM_SEQ)		AS CMMT_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_ITEM WHERE AA.BITEM_SEQ = BITEM_SEQ AND BITEM_LVL > 1) AS A_CNT
			, (SELECT CASE WHEN AA.REGDTM + NVL(NEWD_STDT,0) > TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') THEN 'Y' ELSE 'N' END
				FROM TB_BOARD_MNG WHERE AA.BOARD_SEQ = BOARD_SEQ )						AS NEW_YN
		]]>
		FROM TB_BOARD_ITEM AA
		WHERE BITEM_RFK = (SELECT BITEM_RFK FROM TB_BOARD_ITEM WHERE BITEM_SEQ = #{bitem_seq})
		ORDER BY BITEM_RFK DESC, BITEM_IDX, BITEM_LVL
	</select>

	<select id="BoardSQL.dolistBestBoardItem" resultType="DataMap">
		/*
			SQL ID : BoardSQL.dolistBestBoardItem
			상위 게시물 조회
		*/
		<![CDATA[
		SELECT AA.RSEQ
			, AA.BOARD_SEQ
			, AA.CTGR_SEQ
			, AA.BITEM_SEQ
			, AA.BITEM_TITLE
			, AA.BITEM_IDX
			, AA.BITEM_SEECNT
			, AA.BITEM_RFK
			, AA.BITEM_LVL
			, AA.REGUID
			, (SELECT CDNM FROM TC_COMM_CODE WHERE COMMCD =
				(SELECT BOARD_PCD FROM TB_BOARD_MNG WHERE BOARD_SEQ = AA.BOARD_SEQ))	AS BOARD_PNM
			, (SELECT BOARDNM FROM TB_BOARD_MNG WHERE BOARD_SEQ = AA.BOARD_SEQ)			AS BOARDNM
			, TO_CHAR(AA.REGDTM, 'YYYY.MM.DD')	AS REGDTM
			, (SELECT USERNM FROM TW_ACTOR WHERE USERID = AA.REGUID)					AS REGUNM
			, (SELECT CTGRNM FROM TB_BOARD_CTGR
				WHERE AA.CTGR_SEQ = CTGR_SEQ AND AA.BOARD_SEQ = BOARD_SEQ)				AS CTGRNM
			, (SELECT COUNT(1) FROM TB_BOARD_RECOM WHERE AA.BITEM_SEQ = BITEM_SEQ)		AS RECOM_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_CMMT WHERE AA.BITEM_SEQ = BITEM_SEQ)		AS CMMT_CNT
			, (SELECT COUNT(1) FROM TB_BOARD_ITEM WHERE AA.BITEM_SEQ = BITEM_SEQ AND BITEM_LVL > 1) AS A_CNT
			, (SELECT CASE WHEN AA.REGDTM + NVL(NEWD_STDT,0) > TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS') THEN 'Y' ELSE 'N' END
				FROM TB_BOARD_MNG WHERE AA.BOARD_SEQ = BOARD_SEQ )						AS NEW_YN
		]]>
		FROM (
			SELECT ROW_NUMBER() OVER(ORDER BY ${sidx} ${sord}) AS RSEQ, A.*
			FROM (
				SELECT A.*
				FROM TB_BOARD_ITEM A, TB_BOARD_MNG B
				WHERE A.BOARD_SEQ = B.BOARD_SEQ
					AND SITEID = #{siteid}
					AND USEYN <![CDATA[ <> ]]> 'Y'
				<if test="q_board_seq != null and q_board_seq != ''">
					AND A.BOARD_SEQ = #{q_board_seq}
				</if>
				<if test="swhere != null and swhere != ''">
					${swhere}
				</if>
			) A
		) AA
		WHERE AA.RSEQ <![CDATA[ <= ]]> ${max_rseq}

	</select>

	<insert id="BoardSQL.appendBoardItem" parameterType="dataMap" useGeneratedKeys="false">
		/*
			SQL ID : BoardSQL.appendBoardItem
			게시물 등록
		*/
		INSERT INTO TB_BOARD_ITEM
			( BITEM_SEQ
			, BOARD_SEQ
			, CTGR_SEQ
			, UP_SEQ
			, BITEM_TITLE
			, BITEM_TAGS
			, BITEM_CONT
			, BITEM_RFK
			, BITEM_LVL
			, BITEM_IDX
			, BITEM_SEECNT
			, BITEM_ATTCNT
			, BITEM_OKCNT
			, BITEM_PCD
			, BITEM_OPT
			, BITEM_SCD
			, REGUID
			, MODUID
			, REGDTM
			, MODDTM
			, USEYN
			, SITEID
			)
		VALUES
			( #{bitem_seq	}
			, #{board_seq	}
			, #{ctgr_seq	}
			, #{up_seq		}
			, #{bitem_title	}
			, #{bitem_tags	}
			, #{bitem_cont	}
			, #{bitem_rfk}
			, #{bitem_lvl	}
			, #{bitem_idx	}
			, 0
			, #{bitem_attcnt}
			, 0
			, #{bitem_pcd	}
			, #{bitem_opt	}
			, #{bitem_scd	}
			, #{userid		}
			, #{userid		}
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, 'Y'
			, #{siteid		}
			)
	</insert>

	<update id="BoardSQL.modifyBoardItem" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.modifyBoardItem
			게시물 수정
		*/
		UPDATE TB_BOARD_ITEM
		SET BITEM_TITLE		= #{bitem_title},
			BITEM_CONT		= #{bitem_cont},
			CTGR_SEQ		= #{ctgr_seq},
			MODDTM			= TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
			MODUID			= #{userid}
		WHERE BITEM_SEQ = #{bitem_seq}
		AND SITEID = #{siteid}
	</update>

	<update id="BoardSQL.modifyViewCnt" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.modifyViewCnt
			조회수 증가
		*/
		UPDATE TB_BOARD_ITEM
		SET BITEM_SEECNT = BITEM_SEECNT + 1
		WHERE BITEM_SEQ = #{bitem_seq}
		AND SITEID = #{siteid}
	</update>

	<update id="BoardSQL.modifyOrders" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.modifyOrders
			순번 수정
		*/
		UPDATE TB_BOARD_ITEM
		SET BITEM_IDX = BITEM_IDX + 1
		WHERE BITEM_RFK = #{bitem_rfk}
			AND BITEM_IDX >= #{bitem_idx}
			AND SITEID = #{siteid}
	</update>

	<update id="BoardSQL.modifyDeleteBoardItem" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.modifyDeleteBoardItem
			게시물  삭제
		*/

		UPDATE TB_L_BOARDITEM
		SET BITEM_TITLE		= #{bitem_title},
			BITEM_CONT		= #{bitem_cont},
			USEYN			= 'N',
			MODDTM			= TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS'),
			MODUID			= #{userid}
		WHERE BITEM_SEQ = #{bitem_seq}
	</update>

	<delete id="BoardSQL.removeBoardItem" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardItem
			게시물  완전 삭제
		*/
		DELETE FROM TB_BOARD_ITEM
		WHERE BITEM_SEQ = #{bitem_seq}
	</delete>



<!-- ====================================================================================== -->
<!--						첨부파일 (TB_BOARD_ATTACH)										-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.dolistBoardAttach" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.dolistBoardAttach
			첨부파일 리스트 조회
		*/
		SELECT * FROM TB_BOARD_ATTACH A
		WHERE 1 = 1
			AND BITEM_SEQ = #{bitem_seq}
			AND SITEID = #{siteid}
	</select>

	<select id="BoardSQL.getoneBoardAttach" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.getoneBoardAttach
			하나의 파일조회
		*/
		SELECT A.* FROM TB_BOARD_ATTACH A
		WHERE ATTF_SEQ = #{attf_seq}
			AND SITEID = #{siteid}
	</select>

	<insert id="BoardSQL.appendBoardAttach" parameterType="dataMap" useGeneratedKeys="false">
		/*
			SQL ID : BoardSQL.appendBoardAttach
			게시물 파일 등록
		*/
		INSERT INTO TB_BOARD_ATTACH
			( ATTF_SEQ
			, BITEM_SEQ
			, ATTF_LOGINM
			, ATTF_PHYSNM
			, ATTF_SIZE
			, ATTF_MIME
			, ATTF_EXT
			, REGUID
			, REGDTM
			, SITEID
			)
		VALUES
			( #{attf_seq}
			, #{bitem_seq}
			, #{attf_loginm}
			, #{attf_physnm}
			, #{attf_size}
			, #{attf_mime}
			, #{attf_ext}
			, #{userid}
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{siteid}
			)
	</insert>

	<delete id="BoardSQL.removeBoardAttach" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardAttach
					첨부파일 삭제
		*/
		DELETE FROM TB_BOARD_ATTACH
		WHERE BITEM_SEQ = #{bitem_seq} AND ATTF_SEQ = #{attf_seq}
	</delete>

	<delete id="BoardSQL.removeBoardAttachAll" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardAttachAll
			게시물에 달린 첨부파일 삭제
		*/
		DELETE TB_BOARD_ATTACH
		WHERE BITEM_SEQ = #{bitem_seq}
	</delete>



   
<!-- ====================================================================================== -->
<!--						덧글 (TB_BOARD_CMMT)												-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.selectBoardCmmt" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.selectBoardCmmt
			덧글 데이터 조회
		*/
		SELECT A.*
			, TO_CHAR(A.REGDTM, 'YYYY-MM-DD HH24:MI') AS F_REGDTM
			, (SELECT USERNM FROM TW_ACTOR WHERE USERID = A.REGUID) AS REGUNM
		FROM TB_BOARD_CMMT A
		WHERE 1 = 1
		<if test="bitem_seq != null and bitem_seq != ''">
			AND BITEM_SEQ = #{bitem_seq}
		</if>
		<if test="cmmt_seq != null and cmmt_seq != ''">
			AND CMMT_SEQ = #{cmmt_seq}
		</if>
		ORDER BY CMMT_SEQ DESC
	</select>

	<insert id="BoardSQL.appendBoardCmmt" parameterType="dataMap" useGeneratedKeys="false">
		/*
			SQL ID : BoardSQL.appendBoardCmmt
			덧글  등록
		*/
		INSERT INTO TB_BOARD_CMMT
			( CMMT_SEQ
			, BITEM_SEQ
			, CMMT_CONT
			, CMMT_ECD
			, CMMT_OKCNT
			, CMMT_OPCNT
			, REGUID
			, REGDTM
			, SITEID
			)
		VALUES
			( #{cmmt_seq}
			, #{bitem_seq}
			, #{cmmt_cont}
			, #{cmmt_ecd}
			, 0
			, 0
			, #{userid}
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{siteid}
			)
	</insert>

	<delete id="BoardSQL.removeBoardCmmt" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardCmmt
			댓글 삭제
		*/
		DELETE FROM TB_BOARD_CMMT
		WHERE CMMT_SEQ = #{cmmt_seq}
			AND SITEID = #{siteid}
	</delete>

	<delete id="BoardSQL.removeBoardCmmtAll" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardCmmtAll
			게시물에 달린 댓글 전체 삭제
		*/
		DELETE FROM TB_BOARD_CMMT
		WHERE BITEM_SEQ = #{bitem_seq}
	</delete>



<!-- ====================================================================================== -->
<!--						게시판 권한 (TB_BOARD_AUTH)										-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.dolistBoardAuth" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.dolistBoardAuth
			게시판 권한 조회
			-- AND A.AUTH_SEQ NOT IN (1, 2)
		*/
		SELECT A.AUTH_SEQ
			, A.ROLE_NM
			, (SELECT B.AUTH_LCD FROM TB_BOARD_AUTH B
				WHERE A.AUTH_SEQ = B.AUTH_SEQ
					AND SITEID = #{siteid}
					AND B.BOARD_SEQ = #{board_seq}) AS AUTH_LCD
		FROM TC_USER_ROLE A
		WHERE 1 = 1
			AND SITEID = #{siteid}
	</select>

	<select id="BoardSQL.getoneBoardAuth" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.getoneBoardAuth
			권한 싱글데이터 조회
		*/
		SELECT AUTH_LCD
		FROM TB_BOARD_AUTH
		WHERE BOARD_SEQ = #{board_seq} AND AUTH_SEQ = #{auth_seq}
	</select>

	<insert id="BoardSQL.appendBoardAuth" parameterType="dataMap" useGeneratedKeys="false">
		/*
			SQL ID : BoardSQL.appendBoardAuth
			게시판 사용자 권한 등록
		*/
		INSERT INTO TB_BOARD_AUTH
			( AUTH_SEQ
			, BOARD_SEQ
			, AUTH_LCD
			, REGUID
			, MODUID
			, REGDTM
			, MODDTM
			, SITEID
			)
		VALUES
			( #{auth_seq}
			, #{board_seq}
			, #{auth_lcd}
			, #{userid}
			, #{userid}
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{siteid}
			)
	</insert>

	<delete id="BoardSQL.removeBoardAuth" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardAuth
			게시판 사용자 권한 삭제
		*/
		DELETE FROM TB_BOARD_AUTH
		WHERE BOARD_SEQ = #{board_seq}
			AND SITEID = #{siteid}
	</delete>



<!-- ====================================================================================== -->
<!--						게시판 카테고리 (TB_BOARD_CTGR)									-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.dolistBoardCtgr" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.dolistBoardCtgr
			CATEGORY 조회
		*/
		SELECT A.* FROM TB_BOARD_CTGR A
		WHERE 1 = 1
			AND A.BOARD_SEQ = #{board_seq}
			AND SITEID = #{siteid}
		<if test="q_useyn != null and q_useyn != ''">
			AND A.USEYN = #{q_useyn}
		</if>
		ORDER BY SORT_ORDERS
	</select>

	<insert id="BoardSQL.appendBoardCtgr" parameterType="dataMap" useGeneratedKeys="false">
		/*
			SQL ID : BoardSQL.appendBoardCtgr
			게시판 카테고리 등록
		*/
		INSERT INTO TB_BOARD_CTGR
			( CTGR_SEQ
			, BOARD_SEQ
			, CTGRNM
			, SORT_IDX
			, REGUID
			, MODUID
			, REGDTM
			, MODDTM
			, USEYN
			, SITEID
			)
		VALUES
			( #{ctgr_seq}
			, #{board_seq}
			, #{ctgrnm}
			, #{sort_idx}
			, #{userid}
			, #{userid}
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, TO_CHAR(SYSDATE, 'YYYYMMDDHH24MISS')
			, #{useyn}
			, #{siteid}
			)
	</insert>

	<delete id="BoardSQL.deleteBoardCtgr" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.deleteBoardCtgr
			게시판 카테고리 삭제
		*/
		DELETE TB_BOARD_CTGR 
		WHERE BOARD_SEQ =  #{board_seq}
			AND SITEID = #{siteid}
	</delete>


<!-- ====================================================================================== -->
<!--						게시판 추천 (TB_BOARD_RECOM)										-->
<!-- ====================================================================================== -->

	<delete id="BoardSQL.removeBoardRecomAll" parameterType="dataMap">
		/*
			SQL ID: BoardSQL.removeBoardRecomAll
			게시물에 달린추천 전체 삭제
		*/
		DELETE FROM TB_BOARD_RECOM
		WHERE BITEM_SEQ = #{bitem_seq}
	</delete>



<!-- ====================================================================================== -->
<!--						공통코드 (TC_COMM_CODE)											-->
<!-- ====================================================================================== -->

	<select id="BoardSQL.dolistCommonCd" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: BoardSQL.dolistCommonCd
			게시판 권한 종류 조회
		*/
		SELECT * FROM TC_COMM_CODE A
		WHERE A.USEYN = 'Y' AND A.UP_COMMCD = 'AUTH_LCD'
		ORDER BY A.IDX
	</select>

</mapper>