<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="MyPageSQL">

	<select id="MyPageSQL.doGetResearcherInfo" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: MyPageSQL.doGetResearcherInfo
			연구자 목록 조회
		*/
		<![CDATA[
		SELECT 
			RESEARCHER_NM
			, A.BIZ_NAME
			, RE_INTRO_FIELD
			, KEYWORD
			, SPLIT_PART(KEYWORD::VARCHAR, ',', 1) AS KEYWORD1
			, SPLIT_PART(KEYWORD::VARCHAR, ',', 2) AS KEYWORD2
			, SPLIT_PART(KEYWORD::VARCHAR, ',', 3) AS KEYWORD3
			, SPLIT_PART(KEYWORD::VARCHAR, ',', 4) AS KEYWORD4
			, SPLIT_PART(KEYWORD::VARCHAR, ',', 5) AS KEYWORD5
			, TECH_CODE1
			, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = TECH_CODE1) AS CODE_NAME1
			, TECH_CODE2
			, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = TECH_CODE2) AS CODE_NAME2
			, TECH_CODE3
			, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = TECH_CODE3) AS CODE_NAME3
			, RESEARCHER_SEQNO
		FROM TBLRESEARCHER AS A
		INNER JOIN (SELECT * FROM TBLMEMBER WHERE id = '${id}') AS B
		ON A.MEMBER_SEQNO = B.MEMBER_SEQNO
		]]>
	</select>
	
	<select id="MyPageSQL.doGetCodeListInfo" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: MyPageSQL.doGetCodeListInfo
			연구자 기술분류 목록
		*/
		<![CDATA[
			SELECT
				*
			FROM
				TBTECH_CODE
			WHERE CODE_DEPTH = #{depth}::INT
			
		]]>
			<if test="parent_code_key != ''">
			AND PARENT_CODE_KEY = #{parent_code_key}
			</if>
			ORDER BY CODE_KEY ASC
	</select>
	
	<select id="MyPageSQL.doGetSimilar" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : SubjectFrontSQL.doSimilarResearchList
			유사분야 연구자 리스트
		*/
		<![CDATA[
			SELECT DISTINCT RESEARCH_NO, RESEARCH_NM, KEYWORD, TECH_NM1, TECH_NM2, TECH_NM3, APPLICANT_NM, APPLICANT_DATE
			
			FROM TBRESEARCH 
		]]>
		<if test="researcher_seqno != ''">
			WHERE NOT RESEARCH_SEQNO IN (#{researcher_seqno}::INT)
		</if>
		<choose>
			<when test="keyword_split1 != ''">
				<if test="keyword_split1 != ''">
					AND KEYWORD LIKE '%' || #{keyword_split1} || '%'
				</if>
				<if test="keyword_split2 != ''">
					AND KEYWORD LIKE '%' || #{keyword_split2} || '%'
				</if>
				<if test="keyword_split3 != ''">
					AND KEYWORD LIKE '%' || #{keyword_split3} || '%'
				</if>
			</when>
			<otherwise>
				AND KEYWORD = #{keyword}
			</otherwise>
		</choose>
		
 		 ORDER BY APPLICANT_DATE DESC
 		 LIMIT 3;
	</select>
	
	<select id="MyPageSQL.doGetProject" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : MyPageSQL.doGetProject
			마이페이지 국가 과제 수행이력
		*/
		SELECT DISTINCT ON(ASSIGNM_NO)
			ASSIGNM_NO, RE_PROJECT_NM, RE_INSTITU_NM, RE_START_DATE, RE_END_DATE
		FROM(	
		SELECT ASSIGNM_NO, RE_PROJECT_NM, RE_INSTITU_NM, RE_START_DATE, RE_END_DATE
		FROM TBLRESEARCH_HISTORY
		WHERE RESEARCHER_SEQNO = '${researcher_seqno}'
		UNION ALL
		SELECT ASSIGNM_NO,RE_PROJECT_NM, RE_INSTITU_NM, RE_START_DATE, RE_END_DATE
		FROM TBLRESEARCH_TEMP
		WHERE RESEARCHER_SEQNO = '${researcher_seqno}'
		) A
		ORDER BY ASSIGNM_NO DESC
	</select>
	
	<select id="MyPageSQL.doGetHistory" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : MyPageSQL.doGetHistory
			연구히스토리 리스트
		*/
		SELECT DISTINCT ON(HIS_DATE)
				SUBSTRING(RE_START_DATE, 0, 5) AS HIS_DATE,
				RE_START_DATE,
				KEYWORD
		FROM (			
			SELECT RE_START_DATE, KEYWORD
			FROM TBLRESEARCH_TEMP WHERE RESEARCHER_SEQNO = '${researcher_seqno}'
			UNION ALL
			SELECT RE_START_DATE, KEYWORD
			FROM TBLRESEARCH_HISTORY WHERE RESEARCHER_SEQNO = '${researcher_seqno}'
		) A
		ORDER BY HIS_DATE DESC 
		LIMIT 5
	</select>
	
	<select id="MyPageSQL.doGetInvent" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : MyPageSQL.doGetInvent
			마이페이지 특허 리스트
		*/
		<![CDATA[
			SELECT RESEARCH_SEQNO, INVENT_NM, APPLICATION_NO, APPLICANT_DATE
			
			FROM TBLRESEARCH_TEMP
		]]>
		<if test="researcher_seqno != ''">
			WHERE RESEARCHER_SEQNO = '${researcher_seqno}'
		</if>
		ORDER BY APPLICANT_DATE DESC
	</select>
	
	<update id="MyPageSQL.doUpdateResearcher" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doUpdateResearcher
			마이페이지 연구자 수정
		*/
		UPDATE TBLRESEARCHER
		SET TECH_CODE1 = '${selStdClassCd1}',
			TECH_CODE2 = '${selStdClassCd2}',
			TECH_CODE3 = '${selStdClassCd3}',
			KEYWORD = '${keyword1}${keyword2}${keyword3}${keyword4}${keyword5}',
			RE_INTRO_FIELD = '${re_intro_field}'
		WHERE RESEARCHER_SEQNO= '${researcher_seqno}'
	</update>
	
	<update id="MyPageSQL.doUpdateInvent" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doUpdateInvent
			마이페이지 연구자 특허 수정
		*/
		UPDATE TBLRESEARCH_TEMP
		SET INVENT_NM = '${invent_nm}',
			 APPLICATION_NO = '${applicant_no}',
			 APPLICANT_DATE = '${applicant_dt}'
		WHERE RESEARCH_SEQNO= '${research_seqno}'
	</update>
	
	<insert id="MyPageSQL.doInsertExcel" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doInsertExcel
			마이페이지 연구자 엑셀 데이터 입력
		*/	
			INSERT INTO
				TBEXCEL_RESEARCH
			VALUES
			(
				'${ex_assignm_no}',
				'${ex_re_project_nm}',
				'${ex_re_institu_nm}',
				'${ex_re_start_date}',
				'${ex_re_end_date}',
				'${ex_keyword}'	
			);
	</insert>
	
	<insert id="MyPageSQL.doInsertHistory" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doInsertHistory
			마이페이지 연구자 과제/히스토리 추가
		*/	
			INSERT INTO
				TBLRESEARCH_HISTORY
			(
				researcher_seqno,
				assignm_no,
				re_project_nm,
				re_institu_nm,
				re_start_date,
				re_end_date,
				keyword
			)	
			VALUES
			(
				'${researcher_seqno}',
				'${ex_assignm_no}',
				'${ex_re_project_nm}',
				'${ex_re_institu_nm}',
				'${ex_re_start_date}',
				'${ex_re_end_date}',
				'${ex_keyword}'	
			);
	</insert>
	
	<select id="MyPageSQL.doCountResearcherItem" resultType="int">
		/*
			SQL ID : MyPageSQL.doCountResearcherItem
			연구자 카운트
		*/
		<![CDATA[
		SELECT COUNT(*)
		FROM (
			SELECT tc.researcher_seqno
					,tc.researcher_nm
					,tc.biz_name
					, tc.keyword
					, MAX(applicant_date) as applicant_date
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE1) AS CODE_NAME1
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE2) AS CODE_NAME2
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE3) AS CODE_NAME3
					, view_yn
			from tblresearcher tc
			inner join tblresearch_temp tp ON tc.researcher_seqno = tp.researcher_seqno
			where tc.biz_name = '${biz_name}' 
		]]>	
			<if test="list != 'all'" >
				AND tc.view_yn = 'Y'
			</if>
			<if test="keyword != ''" >
			AND tc.keyword like CONCAT('%',#{keyword},'%')
			</if>
			<if test="strDate != ''" >
		<![CDATA[	
			AND '${strDate}' <= applicant_date
		]]>		
			</if>
			<if test="endDate != ''" >
		<![CDATA[	
			AND applicant_date <= '${endDate}'
		]]>		
			</if>
			<if test="filterStdClassCd1 != ''" >
			AND tc.tech_code1 = '${filterStdClassCd1}'
			</if>
			<if test="filterStdClassCd2 != ''" >
			AND tc.tech_code2 = '${filterStdClassCd2}'
			</if>
			<if test="filterStdClassCd3 != ''" >
			AND tc.tech_code3 = '${filterStdClassCd3}'
			</if>
			GROUP BY tc.researcher_seqno
			ORDER BY applicant_date desc
		) CT	
	</select>
	
	<select id="MyPageSQL.doGetTloResearchList" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: MyPageSQL.doGetTloResearchList
			TLO 연구자 목록 
		*/
		<![CDATA[
			SELECT tc.researcher_seqno
					,tc.researcher_nm
					,tc.biz_name
					, tc.keyword
					, MAX(applicant_date) as applicant_date
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE1) AS CODE_NAME1
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE2) AS CODE_NAME2
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE3) AS CODE_NAME3
					, view_yn
			from tblresearcher tc
			inner join tblresearch_temp tp ON tc.researcher_seqno = tp.researcher_seqno
			where tc.biz_name = '${biz_name}' 
		]]>	
			<if test="list != 'all'" >
				AND tc.view_yn = 'Y'
			</if>
			<if test="keyword != ''" >
			AND tc.keyword like CONCAT('%',#{keyword},'%')
			</if>
			<if test="strDate != ''" >
		<![CDATA[	
			AND '${strDate}' <= applicant_date
		]]>		
			</if>
			<if test="endDate != ''" >
		<![CDATA[	
			AND applicant_date <= '${endDate}'
		]]>		
			</if>
			<if test="filterStdClassCd1 != ''" >
			AND tc.tech_code1 = '${filterStdClassCd1}'
			</if>
			<if test="filterStdClassCd2 != ''" >
			AND tc.tech_code2 = '${filterStdClassCd2}'
			</if>
			<if test="filterStdClassCd3 != ''" >
			AND tc.tech_code3 = '${filterStdClassCd3}'
			</if>
			GROUP BY tc.researcher_seqno
			ORDER BY applicant_date desc
			LIMIT ${rows} OFFSET (${page}-1)*5;
	</select>
	
	<update id="MyPageSQL.doUpdateViewYn" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doUpdateViewYn
			마이페이지 tlo 연구자 목록관리
		*/
			UPDATE TBLRESEARCHER
			SET VIEW_YN = '${view_yn}'
			WHERE RESEARCHER_SEQNO= '${researcher_seqno}'
	</update>
	
	<select id="MyPageSQL.doGetTloDetail" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: MyPageSQL.doGetTloDetail
			TLO 연구자  상세 
		*/
		<![CDATA[
		SELECT A.RESEARCHER_SEQNO
				, RESEARCHER_NM
				, A.BIZ_NAME
				, RE_INTRO_FIELD
				, KEYWORD
				, SPLIT_PART(KEYWORD::VARCHAR, ',', 1) AS KEYWORD1
				, SPLIT_PART(KEYWORD::VARCHAR, ',', 2) AS KEYWORD2
				, SPLIT_PART(KEYWORD::VARCHAR, ',', 3) AS KEYWORD3
				, SPLIT_PART(KEYWORD::VARCHAR, ',', 4) AS KEYWORD4
				, SPLIT_PART(KEYWORD::VARCHAR, ',', 5) AS KEYWORD5
				, TECH_CODE1
				, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = TECH_CODE1) AS CODE_NAME1
				, TECH_CODE2
				, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = TECH_CODE2) AS CODE_NAME2
				, TECH_CODE3
				, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = TECH_CODE3) AS CODE_NAME3
				, B.manager_seqno
				, manager_demand
				, manager_rank
				, manager_name
				, manager_mobile_no
				, manager_email
		FROM tblresearcher A
		LEFT OUTER JOIN tblmanager B ON A.manager_seqno = B.manager_seqno
		WHERE A.RESEARCHER_SEQNO = '${researcher_seqno}'
		]]>
	</select>
	
	<update id="MyPageSQL.doUpdateManager" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doUpdateManager
			마이페이지 연구자 담당자 수정
		*/
		UPDATE tblmanager A
		SET MANAGER_DEMAND = '${manager_demand}',
			MANAGER_RANK = '${manager_rank}',
			MANAGER_NAME = '${manager_name}',
			MANAGER_MOBILE_NO = '${tel}',
			MANAGER_EMAIL = '${mail}'
		FROM
			tblresearcher B
		WHERE
			B.manager_seqno = A.manager_seqno
		AND B.researcher_seqno = '${researcher_seqno}'
	</update>
	
	<select id="MyPageSQL.doCountAdminResearcherItem" resultType="int">
		/*
			SQL ID : MyPageSQL.doCountAdminResearcherItem
			연구자 카운트
		*/
		<![CDATA[
		select COUNT(*) 
		from tblresearcher
		where 1=1
		]]>
		<if test="list != 'all'" >
			AND view_yn = 'Y'
		</if>
		<if test="keyword != ''" >
			AND keyword like CONCAT('%',#{keyword},'%')
		</if>
		<if test="strDate != ''" >
		<![CDATA[	
			AND '${strDate}' <= applicant_date 
		]]>		
		</if>
		<if test="endDate != ''" >
		<![CDATA[	
			AND applicant_date <= '${endDate}'
		]]>		
			</if>
		<if test="filterStdClassCd1 != ''" >
			AND tech_code1 = '${filterStdClassCd1}'
			</if>
			<if test="filterStdClassCd2 != ''" >
			AND tech_code2 = '${filterStdClassCd2}'
			</if>
			<if test="filterStdClassCd3 != ''" >
			AND tech_code3 = '${filterStdClassCd3}'
			</if>
	</select>
	
	<select id="MyPageSQL.doGetAdminResearchList" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID: MyPageSQL.doGetAdminResearchList
			관리자 연구자 목록 
		*/
		<![CDATA[
			SELECT tc.researcher_seqno
					,tc.researcher_nm
					,tc.biz_name
					, tc.keyword
					, MAX(applicant_date) as applicant_date
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE1) AS CODE_NAME1
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE2) AS CODE_NAME2
					, (SELECT CODE_NAME FROM TBTECH_CODE AS AA WHERE AA.CODE_KEY = tc.TECH_CODE3) AS CODE_NAME3
					, view_yn
			from tblresearcher tc
			inner join tblresearch_temp tp ON tc.researcher_seqno = tp.researcher_seqno
		]]>	
			<if test="list != 'all'" >
				AND tc.view_yn = 'Y'
			</if>
			<if test="keyword != ''" >
			AND tc.keyword like CONCAT('%',#{keyword},'%')
			</if>
			<if test="strDate != ''" >
		<![CDATA[	
			AND '${strDate}' <= applicant_date
		]]>		
			</if>
			<if test="endDate != ''" >
		<![CDATA[	
			AND applicant_date <= '${endDate}'
		]]>		
			</if>
			<if test="filterStdClassCd1 != ''" >
			AND tc.tech_code1 = '${filterStdClassCd1}'
			</if>
			<if test="filterStdClassCd2 != ''" >
			AND tc.tech_code2 = '${filterStdClassCd2}'
			</if>
			<if test="filterStdClassCd3 != ''" >
			AND tc.tech_code3 = '${filterStdClassCd3}'
			</if>
			GROUP BY tc.researcher_seqno
			ORDER BY applicant_date desc
			LIMIT ${rows} OFFSET (${page}-1)*5;
	</select>
	
	<select id="MyPageSQL.doCountTloMatchList" resultType="int">
		/*
			SQL ID : MyPageSQL.doCountTloMatchList
			TLO 매칭목록 카운트
		*/
		select COUNT(*)
		from (
			select DISTINCT tr.*, td.*,  td.member_seqno as demand_no
			      , tr.keyword as Rkwd
			      , td.keyword as Bkwd
			      , td.update_date as rupdate
			      , tr.member_seqno as resear_no
			      , MAX(applicant_date) applicant_date
			      , ( select code_name from tbiz.tbtech_code D where D.code_key = tr.tech_code1) as Rcode_name1
			      , ( select code_name from tbiz.tbtech_code D where D.code_key = tr.tech_code2) as Rcode_name2
			      , ( select code_name from tbiz.tbtech_code D where D.code_key = tr.tech_code3) as Rcode_name3
			      , ( select code_name from tbiz.tbtech_code D where D.code_key = td.tech_code1) as Bcode_name1
			      , ( select code_name from tbiz.tbtech_code D where D.code_key = td.tech_code2) as Bcode_name2
			      , ( select code_name from tbiz.tbtech_code D where D.code_key = td.tech_code3) as Bcode_name3
			      from tbiz.tblresearcher tr
			      inner join tbiz.tbldemand td on (
			                                 (case when td.tech_code1 like tr.tech_code1 then 1 else 0 end +
			                                  case when td.tech_code2 like tr.tech_code2 then 1 else 0 end +
			                                  case when td.tech_code3 like tr.tech_code3 then 1 else 0 end) >=2
			                                 )
			      inner JOIN tblresearch_temp tp ON tr.researcher_seqno = tp.researcher_seqno                            
			      LEFT join tbiz.tblmatchlist tc on tr.researcher_seqno = tc.researcher_seqno 
			      and td.demand_seqno = tc.demand_seqno 
			      <if test="member_type != 'ADMIN'" >
			      where tr.biz_name='${biz_name}'
			      </if>
			      AND (
			          (SELECT COUNT(*) FROM unnest(string_to_array(td.keyword, ',')) AS keyword_list
			           WHERE keyword_list = ANY(string_to_array(tr.keyword, ','))) >= 2
			      )
		    <if test="list != 'all'" >
				AND tr.view_yn = 'Y'
			</if>
			<if test="keyword != ''" >
				AND (tr.keyword like CONCAT('%',#{keyword},'%') OR td.keyword like CONCAT('%',#{keyword},'%'))
			</if>
			<if test="strDate != ''" >
			<![CDATA[	
				AND '${strDate}' <= update_date
			]]>		
			</if>
			<if test="endDate != ''" >
			<![CDATA[	
				AND update_date <= '${endDate}'
			]]>		
			</if>
			<if test="strDate2 != ''" >
			<![CDATA[	
				AND '${strDate2}' <= applicant_date
			]]>		
			</if>
			<if test="endDate2 != ''" >
			<![CDATA[	
				AND applicant_date <= '${endDate2}'
			]]>		
			</if>
			<if test="filterStdClassCd1 != ''" >
				AND (tr.tech_code1 = '${filterStdClassCd1}' OR td.tech_code1 = '${filterStdClassCd1}')
			</if>
			<if test="filterStdClassCd2 != ''" >
				AND (tr.tech_code2 = '${filterStdClassCd2}' OR td.tech_code2 = '${filterStdClassCd2}')
			</if>
			<if test="filterStdClassCd3 != ''" >
				AND (tr.tech_code3 = '${filterStdClassCd3}' OR td.tech_code3 = '${filterStdClassCd3}')
			</if>
			GROUP BY tr.researcher_seqno , td.demand_seqno , tc.match_no
		) CT		
	</select>
	
	<select id="MyPageSQL.doGetTloMatchList" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : MyPageSQL.doGetTloMatchList
			TLO 매칭목록
		*/
		select DISTINCT tr.*, td.*,  td.member_seqno as demand_no
		      , tr.keyword as Rkwd
		      , td.keyword as Bkwd
		      , td.update_date as rupdate
		      , tr.member_seqno as resear_no
		      , MAX(applicant_date) applicant_date
		      , ( select code_name from tbiz.tbtech_code D where D.code_key = tr.tech_code1) as Rcode_name1
		      , ( select code_name from tbiz.tbtech_code D where D.code_key = tr.tech_code2) as Rcode_name2
		      , ( select code_name from tbiz.tbtech_code D where D.code_key = tr.tech_code3) as Rcode_name3
		      , ( select code_name from tbiz.tbtech_code D where D.code_key = td.tech_code1) as Bcode_name1
		      , ( select code_name from tbiz.tbtech_code D where D.code_key = td.tech_code2) as Bcode_name2
		      , ( select code_name from tbiz.tbtech_code D where D.code_key = td.tech_code3) as Bcode_name3
		      from tbiz.tblresearcher tr
		      inner join tbiz.tbldemand td on (
		                                 (case when td.tech_code1 like tr.tech_code1 then 1 else 0 end +
		                                  case when td.tech_code2 like tr.tech_code2 then 1 else 0 end +
		                                  case when td.tech_code3 like tr.tech_code3 then 1 else 0 end) >=2
		                                 )
		      inner JOIN tblresearch_temp tp ON tr.researcher_seqno = tp.researcher_seqno                            
		      LEFT join tbiz.tblmatchlist tc on tr.researcher_seqno = tc.researcher_seqno 
		      and td.demand_seqno = tc.demand_seqno 
		      <if test="member_type != 'ADMIN'" >
		      where tr.biz_name='${biz_name}'
		      </if>
		      AND (
		          (SELECT COUNT(*) FROM unnest(string_to_array(td.keyword, ',')) AS keyword_list
		           WHERE keyword_list = ANY(string_to_array(tr.keyword, ','))) >= 2
		      )
	    <if test="list != 'all'" >
			AND tr.view_yn = 'Y'
		</if>
		<if test="keyword != ''" >
			AND (tr.keyword like CONCAT('%',#{keyword},'%') OR td.keyword like CONCAT('%',#{keyword},'%'))
		</if>
		<if test="strDate != ''" >
		<![CDATA[	
			AND '${strDate}' <= update_date
		]]>		
		</if>
		<if test="endDate != ''" >
		<![CDATA[	
			AND update_date <= '${endDate}'
		]]>		
		</if>
		<if test="strDate2 != ''" >
		<![CDATA[	
			AND '${strDate2}' <= applicant_date
		]]>		
		</if>
		<if test="endDate2 != ''" >
		<![CDATA[	
			AND applicant_date <= '${endDate2}'
		]]>		
		</if>
		<if test="filterStdClassCd1 != ''" >
			AND (tr.tech_code1 = '${filterStdClassCd1}' OR td.tech_code1 = '${filterStdClassCd1}')
		</if>
		<if test="filterStdClassCd2 != ''" >
			AND (tr.tech_code2 = '${filterStdClassCd2}' OR td.tech_code2 = '${filterStdClassCd2}')
		</if>
		<if test="filterStdClassCd3 != ''" >
			AND (tr.tech_code3 = '${filterStdClassCd3}' OR td.tech_code3 = '${filterStdClassCd3}')
		</if>
		GROUP BY tr.researcher_seqno , td.demand_seqno , tc.match_no
		LIMIT ${rows} OFFSET (${page}-1)*10;
	</select>
	
	<select id="MyPageSQL.doTloMatchHistoryList" parameterType="dataMap" resultType="dataMap">
		/*
			SQL ID : MyPageSQL.doTloMatchHistoryList
			TLO 매칭 이력 보기
		*/
		select *
		from tbiz.tblmatchlist   
		where researcher_seqno = '${researcher_seqno}'
		AND demand_seqno = '${demand_seqno}'
		ORDER BY match_date DESC
	</select>
	
	<insert id="MyPageSQL.doSetUpdate" parameterType="dataMap">
		/*
			SQL ID : MyPageSQL.doSetUpdate
			마이페이지 TLO/관리자 매칭이력 추가
		*/	
			INSERT INTO
				tblmatchlist
			(
				match_date,
				contents,
				business_nm,
				business_tel,
				business_email,
				researcher_nm,
				researcher_tel,
				researcher_email,
				demand_seqno,
				researcher_seqno
			)	
			VALUES
			(
				'${match_date}',
				'${contents}',
				'${business_nm}',
				'${business_tel}',
				'${business_mail}',
				'${researcher_nm}',
				'${researcher_tel}',
				'${researcher_mail}',
				'${demand_seqno}',
				'${researcher_seqno}'
			);
	</insert>
</mapper>